این داکیومنت نهایی و تجمیع شده است. تمام نکات قبلی به همراه استراتژی پیاده‌سازی سمت کلاینت (JS/HTML) و ارجاع به فایل‌های اکسل شما در آن لحاظ شده است.

این متن را می‌توانید مستقیماً در قالب یک فایل Word یا PDF به برنامه‌نویس تحویل دهید.

---

# مستندات فنی و اجرایی اپلیکیشن صدور پیش‌فاکتور آسانسور

**(Elevator Quote Generator - Client-Side Web App)**

**تاریخ:** ۰۳/۰۱/۲۰۲۴
**وضعیت:** نهایی (جهت اجرا)

---

## ۱. مقدمه و هدف پروژه

هدف، طراحی و پیاده‌سازی یک وب‌اپلیکیشن سبک و سریع (Single Page Application) برای محاسبه خودکار قطعات و صدور پیش‌فاکتور آسانسور است. این سیستم باید بر اساس ورودی‌های کاربر (نوع سیستم و تعداد توقف)، لیست قطعات را محاسبه کرده و امکان ویرایش دستی و خروجی چاپی و اکسل را فراهم کند.

**نکته کلیدی:** این پروژه نیاز به دیتابیس سمت سرور (مانند SQL) ندارد و تماماً باید با **JavaScript** سمت کاربر (Client-Side) پیاده‌سازی شود تا قابلیت اجرا روی مرورگر به صورت آفلاین یا استاتیک را داشته باشد.

---

## ۲. معماری فنی (Technical Stack)

* **زبان و پلتفرم:** HTML5, CSS3, JavaScript (Vanilla JS یا فریم‌ورک‌های سبک مثل Vue.js).
* **دیتابیس:** آرایه JSON (ذخیره شده در یک فایل JS جداگانه جهت ویرایش آسان).
* **خروجی اکسل:** استفاده از کتابخانه `SheetJS` (xlsx).
* **خروجی PDF/چاپ:** استفاده از استایل‌های CSS Print و قابلیت Native مرورگر (`window.print`).

---

## ۳. فایل‌های ضمیمه و منابع داده

سه فایل اکسل به عنوان منبع داده و طراحی بصری به پیوست این سند ارائه می‌شود:

1. **`all_database.xlsx`**: دیتابیس مرجع. تمام اقلام، قیمت‌های پایه، ضرایب محاسباتی و دسته‌بندی‌ها از این فایل باید وارد آرایه JSON برنامه شوند.
2. **`gearless_.xlsx`**: نمونه فاکتور خروجی و لیست اقلام برای سیستم گیرلس.
3. **`hydrolic_.xlsx`**: نمونه فاکتور خروجی و لیست اقلام برای سیستم هیدرولیک.

---

## ۴. جریان کار کاربر (User Flow)

1. **ورود اطلاعات (Header Panel):**
* کاربر در بالای صفحه نوع آسانسور را انتخاب می‌کند (دراپ‌داون: هیدرولیک / گیرلس).
* تعداد توقف را وارد می‌کند (مثلاً: ۷).
* نام مشتری یا عنوان پروژه را می‌نویسد (جهت درج در سربرگ فاکتور).
* دکمه **"ساخت فاکتور"** را می‌زند.


2. **مشاهده و ویرایش (Interactive Invoice):**
* سیستم لیست اقلام را محاسبه و در قالب یک جدول (شبیه فاکتورهای ضمیمه) نمایش می‌دهد.
* **قابلیت ویرایش:** کاربر می‌تواند روی سلول‌های جدول (شرح کالا، تعداد، قیمت واحد) کلیک کرده و مقادیر را تغییر دهد (مشابه اکسل).
* **محاسبه آنی:** با تغییر تعداد یا قیمت واحد، قیمت کل آن ردیف و جمع نهایی فاکتور بلافاصله آپدیت می‌شود.
* **افزودن آیتم:** دکمه‌ای در انتهای جدول وجود دارد ("افزودن سطر جدید") که کاربر می‌تواند کالایی خارج از دیتابیس را به فاکتور فعلی اضافه کند.


3. **خروجی نهایی (Export):**
* دکمه **"چاپ / PDF"**: باز شدن پنجره پرینت مرورگر با طراحی استاندارد A4 (بدون دکمه‌های اضافی صفحه).
* دکمه **"دانلود اکسل"**: دانلود فایل `.xlsx` شامل تمام تغییرات اعمال شده در جدول.



---

## ۵. منطق محاسباتی و دیتابیس (Business Logic)

برنامه‌نویس باید دیتای موجود در `all_database.xlsx` را به ساختار JSON زیر تبدیل کند:

```javascript
const INVENTORY = [
  {
    id: 1,
    name: "سیم بکسل نمره ۱۰",
    unit: "متر",
    category: "gearless",     // مقادیر: gearless | hydraulic | common
    calcType: "coeff_var",    // مقادیر: fixed | simple_var | coeff_var
    price: 145000,
    baseQty: 110,             // مقدار پایه (رزرو)
    coeff: 20                 // ضریب افزایش به ازای هر توقف
  },
  // ... سایر اقلام
];

```

### الگوریتم محاسبه تعداد (Quantity):

هنگام ساخت فاکتور، سیستم باید اقلام را بر اساس `category` فیلتر کند (اقلام `common` همیشه نمایش داده می‌شوند). سپس تعداد (`Qty`) هر کالا طبق فرمول‌های زیر محاسبه شود (`N` = تعداد توقف ورودی کاربر):

1. **نوع `fixed` (ثابت):**
* تعداد = `baseQty` (عدد ثابت موجود در دیتابیس).


2. **نوع `simple_var` (متغیر ساده):**
* تعداد = `N` (دقیقاً برابر با تعداد توقف).


3. **نوع `coeff_var` (متغیر ضریب‌دار):**
* تعداد = `(N × coeff) + baseQty`.



---

## ۶. الزامات رابط کاربری (UI) و طراحی

* **طراحی فاکتور:** ظاهر جدول خروجی (هدر، ستون‌ها، رنگ‌بندی سرستون‌ها و فوتر جمع کل) باید تا حد امکان شبیه به فایل‌های اکسل ضمیمه (`gearless_.xlsx` و `hydrolic_.xlsx`) پیاده‌سازی شود.
* **هدر چاپی:** شامل لوگوی شرکت (یک پلیس‌هولدر قرار دهید)، تاریخ روز، شماره فاکتور و نام مشتری باشد.
* **فوتر چاپی:** شامل جمع کل به عدد و حروف (تبدیل عدد به حروف فارسی) و محل امضا باشد.
* **واکنش‌گرایی (Editability):** اینپوت‌های ویرایش داخل جدول باید کاربرپسند باشند (مثلاً با کلیک فعال شوند و با اینتر ذخیره شوند).

---

## ۷. بروزرسانی قیمت‌ها و نگهداری

از آنجا که پنل ادمین وجود ندارد، ساختار کد باید به گونه‌ای باشد که فایل دیتابیس (`data.js`) از فایل منطق برنامه (`app.js`) جدا باشد.

* کارفرما باید بتواند با باز کردن فایل `data.js` در یک ویرایشگر متن ساده، قیمت‌ها (`price`) را تغییر دهد و با ذخیره فایل، قیمت‌های سایت آپدیت شود.

---

## ۸. تحویل نهایی (Deliverables)

1. سورس کد کامل (HTML/CSS/JS).
2. فایل دیتابیس (`data.js`) که تمام اقلام فایل `all_database.xlsx` در آن ایمپورت شده باشد.
3. اپلیکیشن باید بدون خطا روی مرورگر کروم اجرا شود و خروجی PDF و Excel سالم تحویل دهد.